# Day01——【2017-09-04】
## 任务
    1、搭建项目

    2、完成日志功能模块开发

    3、完成网络请求功能开发
## 项目搭建
本次搭建主要是Android版本开发，iOS后续补充

- 用WS创建项目RnOnE
- 在Android中创建local.properties用于指定AndroidSDK
```
## This file is automatically generated by Android Studio.
# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
#
# This file should *NOT* be checked into Version Control Systems,
# as it contains information specific to your local configuration.
#
# Location of the SDK. This is only used by Gradle.
# For customization when using a Version Control System, please read the
# header note.
sdk.dir=E\:\\AndroidSDK
```
- 创建app文件夹，用于存放JavaScript源码
- 在app中创建index.js，作为App启动入口文件
```
/**
 *===========================================
 * Description:App启动入口文件
 *
 * Author:M-Liu
 *
 * Time:2017/9/4
 *===========================================
 */

import React, { Component } from 'react';
import {
    StyleSheet,
    Text,
    View,
    FlatList,
    Image,
} from 'react-native';

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#F5FCFF',
    },
    welcome: {
        fontSize: 20,
        textAlign: 'center',
        margin: 10,
    },
});
export default class App extends Component {
    constructor(){
        super();
    }

    render() {
        return (
            <View style={styles.container}>
                <Text style={styles.welcome}>
                    RnOnE
                </Text>
            </View>
        );
    }
}
```
- 改变index.android.js入口文件，指向**app/index.js**
```
/**
 *===========================================
 * Description:Android启动入口文件
 *
 * Author:M-Liu
 *
 * Time:2017/9/4
 *===========================================
 */

import React, { Component } from 'react';
import {
  AppRegistry,
} from 'react-native';
import App from './app';
AppRegistry.registerComponent('RnOnE', () => App);
```
## 开发日志模块
    主要功能:
        1、用于开发和调试阶段的日志功能
        2、用于运行时App信息收集
### 在app目录中创建LogUtils.js
相对简单的Log工具，只能用于简单调试，后期随着项目发展，会增加功能
```
export default class LogUtils {
    static NOTHING = 0;
    static INFO = 1;
    static ERROR = 2;
    static log_lever = LogUtils.INFO;//you can change this value to change print lever
    static logMsg = msg =>{
        switch (LogUtils.log_lever){
            case LogUtils.ERROR:
                console.error("RnOnE:"+msg+LogUtils.ERROR);
                break;
            case LogUtils.INFO:
                console.log("RnOnE:"+msg);
                break;
            case LogUtils.NOTHING:
            default:
               //do nothing
                break;
        }
    };
   static errorMsg = msg =>{
        if (LogUtils.log_lever !== LogUtils.NOTHING){
            console.log('RnOnE:'+msg);
        }
    }
}
```
## 开发HTTP模块——'app/http'
    主要功能：
        1、网络请求
        2、网络数据缓存
- 创建**HttpConfig.js**：用于网络基本参数配置
    - convertResponse：用于将请求到数据转换到容易处理的格式
    - defaultHandleResponse：预处理数据结果
```
/**
 *===========================================
 * Description:网络请求配置文件
 *
 * Author:M-Liu
 *
 * Time:2017/9/4
 *===========================================
 */

export const CACHE_TOGGLE = true;
export const BASE_URL = 'http://baidu.com/';

/**
 * covert response
 * */
export const convertResponse = response => {
    return response.json();
};

/**
 * default proxy analyse response
 * @param response
 */
export const defaultHandleResponse = response => {
    if (response.res === 0) {
        return response.data;
    } else {
        console.warn(response.msg);
        throw response.msg;
    }
};
```
- 创建**HttpCache.js**：用于网络缓存
```
/**
 *===========================================
 * Description:网络请求缓存类
 *
 * Author:M-Liu
 *
 * Time:2017/9/4
 *===========================================
 */
import {
    AsyncStorage,
}from 'react-native';
import storage from 'react-native-store';
import LogUtils from '../util/LogUtils';

export default class HttpCacheManager{
    /**
     *
     * @param key 缓存秘钥
     * @param fetchFunc 网络获取Func
     * @param doCache 是否开启缓存
     * @returns {*} 网络请求结果
     */
    saveCache = (key,fetchFunc,doCache= true)=>{
        if (!doCache){
            LogUtils.logMsg('you had closed log info for this url '+key);
            return fetchFunc;
        }
        return fetchFunc.then(value=>{
            LogUtils.logMsg('get data from storage —— key = '+key);
            storage.save(key,value);//save data to local
            return value;
        })
    }
}
```
- 创建HttpManager.js：封装fetch用于网络请求
```
/**
 *===========================================
 * Description:网络数据请求组件
 *
 * Author:M-Liu
 *
 * Time:2017/9/4
 *===========================================
 */
import LogUtils from "../util/LogUtils";
import HttpCacheManager from "./HttpCache";
import {BASE_URL,CACHE_TOGGLE,convertResponse,defaultHandleResponse}from'./HttpConfig';
import React, { Component } from 'react';

export default class HttpManager extends Component{

    /**
     * Constructor
     *  1、create LogUtils
     *  2、create HttpCacheManager
     * */
    constructor(){
        super();
        this.httpCacheManager = new HttpCacheManager();
    }

    /**
     *  request by get
     *  @url full url
     *  @doCache true do cache ;false not cache
     * */
    doGetRequest =(url,doCache = true)=>{
        const fetchFunc = ()=> {
            return fetch(url,{
                method:'GET',
                headers:{
                    Accept:'*/*',
                    'Content-Type':'application/json'
                }
            }).then(convertResponse)
        };
        return this.httpCacheManager.saveCache(url,fetchFunc(),doCache).then(defaultHandleResponse);
    };

    /**
     * request by post
     * @url full url
     * @jsonPostData you want post data
     * @doCache true do cache ;false not cache
     * */
    doPostRequest = (url,jsonPostData,doCache = true) =>{
        LogUtils.errorMsg('do post request \r\n url '+url+'\r\n post data = '+jsonPostData+'\r\n& doCache = '+doCache);
        const fetchFunc = ()=>{
            return fetch({
                method:'POST',
                headers:{
                    Accept:'*/*',
                    'Content-Type':'application/json'
                },
                body:jsonPostData
            }).then(convertResponse);
        };
        return this.httpCacheManager.saveCache(url,fetchFunc(),doCache).then(defaultHandleResponse);
    };

    /**
     *  parser param for get request
     * @param data Object to data
     * @returns {string} params string like '&username=Jack&age=25'
     */
    parserParam = data=>{
        return Object.entries(data).map(([key,value]) => {
            return `${key}=${value}`;
        }).join('&');
    };

    /**
     * encapsulate for doGetRequest
     * @link #doGetRequest
     * @param needCache
     */
    doGet = needCache => (relativePath,data)=>{
        let url = `${BASE_URL}${relativePath}`;
        if(data){
            url.append(`?${this.parserParam(data)}`)
        }
        return this.printRequest(`GET ${url}`)(()=>{
           return this.doGetRequest(url,needCache);
        });
    };

    /**
     * encapsulate for doPostRequest
     * @link #doPostRequest
     * @param needCache
     */
    doPost = needCache => (path,data) => {
        let jsonData = JSON.stringify(data);
        let url = `${BASE_URL}${path}`;
        return this.printRequest(`POST ${url}`)(() => {
            return this.doPostRequest(url,jsonData,needCache);
        })
    };

    getDataCacheToLocal = this.doGet(true);
    getDataNoCahe = this.doGet(false);

    postDataCacheToLocal = this.doPost(true);
    postDataNoCache = this.doPost(false);

    /**
     * print data and cost time
     * @param requestInfo
     */
    printRequest = requestInfo => fetchFunc =>{
        let startTime = new Date().getTime();
        return fetchFunc().then(result => {
            LogUtils.logMsg(`${requestInfo} :
            \r\nresult = ${JSON.stringify(result)};
            \r\ntook time = ${new Date().getTime() - startTime}ms`);
            return result;
        }).catch(err => {
            LogUtils.logMsg(`${requestInfo} ${err}`);
            return Promise.reject(err);
        })
    };
}
```
## 总结
    　　虽然最终完成Day01的开发，但是中间还是出现了很多的BUG,尤其在搭建项目的过程中，总是会出现一些意料之外的“惊喜”，但值得庆幸的是BUG,通过"google+度娘"都解决了，所有Bug都有记录，以及解决方法。
    另外这一天开发过程中，也暴露了对ES6以及ReactNative理解不足和不熟悉。